<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TechDocs and Search :: Building Developer Portals with Red Hat Developer Hub</title>
    <link rel="prev" href="templates.html">
    <link rel="next" href="../chapter2/index.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building Developer Portals with Red Hat Developer Hub</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/devhub-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="devhub-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building Developer Portals with Red Hat Developer Hub</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Software Templates</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="catalog.html">Software Catalog Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="templates.html">Software Templates</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="techdocs.html">TechDocs and Search</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter2/index.html">RHDH Plugins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/dynamic.html">Dynamic Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/topology.html">Kubernetes and Topology Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/quay.html">Quay Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/pipelines.html">Tekton Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/gitops.html">ArgoCD Plugin</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building Developer Portals with Red Hat Developer Hub</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building Developer Portals with Red Hat Developer Hub</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building Developer Portals with Red Hat Developer Hub</a></li>
    <li><a href="index.html">Software Templates</a></li>
    <li><a href="techdocs.html">TechDocs and Search</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">TechDocs and Search</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You learnt about the <code>TechDocs</code> feature of RHDH in the first introductory course of the learning path. In this section, you will get hands-on experience with creating and rendering technical documentation for your catalog components.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_techdocs_using_markdown"><a class="anchor" href="#_writing_techdocs_using_markdown"></a>Writing TechDocs Using Markdown</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TechDocs uses the popular MkDocs library to generate documentation for your applications. You write markdown files (<strong>.md</strong> file extension) alongside your application&#8217;s source code, and store either in the same repository where you maintain the application, or an external repository which can then be referenced in your catalog YAML files.</p>
</div>
<div class="paragraph">
<p>Your raw plain text source markdown files are then converted to HTML, and then displayed as HTML in the RHDH web UI. There are several ways to configure how RHDH fetches, generates and publishes documents.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_techdocs_concepts_and_terminology"><a class="anchor" href="#_techdocs_concepts_and_terminology"></a>TechDocs Concepts and Terminology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the important components of TechDocs:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Preparer</dt>
<dd>
<p>The Preparer gets the source markdown files from a Git repository and sends it to the generator for further processing.</p>
</dd>
<dt class="hdlist1">Generator</dt>
<dd>
<p>The generator uses the raw markdown files input and converts it to HTML. The RHDH container has an in-built version of MkDocs packaged inside it.</p>
</dd>
<dt class="hdlist1">Publisher</dt>
<dd>
<p>The publisher stores the generated HTML files either locally on the RHDH container file system, or in external cloud storage (AWS S3, GCP Cloud Storage, Azure Blob etc).</p>
</dd>
<dt class="hdlist1">Builder</dt>
<dd>
<p>Builders are closely linked to the generator stage and typically offer multiple ways to build the markdown content to HTML. By default, RHDH uses a locally installed builder to generate the HTML files. You can also configure an external CI/CD workflow to fetch the markdown source, build the HTML externally, and publish the generated HTML to external storage. RHDH can then be configured to fetch the generated HTML files from external storage.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By default, RHDH is configured to use an "all local" solution, that is, generator, builder and publisher are all run locally and the HTML is stored in the container file system.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates an "all local" configuration of TechDocs:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/techdocs-arch-local.png" alt="techdocs arch local">
</div>
<div class="title">Figure 1. TechDocs Architecture for Local Storage and Publishing</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When a client requests documentation for a component, the component ID is sent to the RHDH backend API. The backend API fetches the raw markdown source from a Git repository where the documentation is maintained.</p>
</li>
<li>
<p>The RHDH backend converts the raw markdown to HTML and publishes it to the local file system inside the container.</p>
</li>
<li>
<p>The client is then sent the generated HTML files from local file system storage. RHDH intelligently caches the generated HTML files so that subsequent requests to documentation are faster.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The "all local" approach is recommended only for small sized installations of RHDH with a few components. This approach will not scale to medium sized and large installations with hundreds or thousands of components. Recall that RHDH is running as a container, so this approach results is duplicating the HTML files and other processes across all the RHDH pods.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates the production recommended external publication and builder configuration of TechDocs:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/techdocs-arch-external.png" alt="techdocs arch external">
</div>
<div class="title">Figure 2. TechDocs Architecture for External Storage and Publishing</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A CI/CD workflow (GitHub Actions, Jenkins scripts etc) converts the markdown to HTML and stores the generated files in external cloud storage.</p>
</li>
<li>
<p>The backend registers the location of the HTML files for all the components where TechDocs is enabled.</p>
</li>
<li>
<p>When a client requests documentation for a component, the backend fetches the HTML and other static files from external storage and sends it to the client.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The source document conversion and publication process happens completely detached (asynchronously) in the CI/CD workflow (in github actions, gitlab pipeline runners, etc.), irrespective of user requests for documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is the recommended set up for production. CI/CD workflows convert the markdown to HTML asynchronously based on webhook triggers on the documentation repository and publish the generated HTML to external cloud storage. RHDH acts as a pure stateless engine and fetches the HTML for a component based on client request. This approach can scale to large installations with hundreds or thousands of components.</p>
</div>
<div class="paragraph">
<p>The following labs will cover these scenarios and give you hands-on experience with configuring and writing TechDocs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_search"><a class="anchor" href="#_search"></a>Search</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You do not have to configure anything extra for basic search functionality in RHDH. RHDH automatically indexes your documentation and enables rapid search functionality for your developers. For more complex search requirements for large installations, consult the documentation at <a href="https://backstage.io/docs/features/search" class="bare">https://backstage.io/docs/features/search</a> for details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_basic_techdocs_in_local_mode"><a class="anchor" href="#_lab_basic_techdocs_in_local_mode"></a>Lab: Basic TechDocs in Local Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enabling TechDocs in "all local" mode involves three major tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the Catalog YAML files</p>
</li>
<li>
<p>Configuring MkDocs</p>
</li>
<li>
<p>Enabling the TechDocs Plug-in</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Explore the template file at <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/templates/react-ssr/skeleton/catalog-info.yaml" class="bare">https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/templates/react-ssr/skeleton/catalog-info.yaml</a>. Note the <code>backstage.io/techdocs-ref</code> annotation that points to the root of the document sources relative to the <code>catalog-info.yaml</code> file</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  ...
  annotations:
    ...
    backstage.io/techdocs-ref: dir:. <i class="conum" data-value="1"></i><b>(1)</b>
    #backstage.io/techdocs-ref: url:https://github.com/org-name/repo-name <i class="conum" data-value="2"></i><b>(2)</b>
spec:
  type: website
  ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Location of document source. For MkDocs, a default folder called <code>docs</code> in the root of the repository contains the markdown source.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If documentation is maintained in a separate repository, you can refer to the URL of the repository using "url:" prefix.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Inspect the <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/templates/react-ssr/skeleton/mkdocs.yml" class="bare">https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/templates/react-ssr/skeleton/mkdocs.yml</a> file. It contains the MkDocs configuration for the component.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">site_name: ...
site_description: ...

plugins:
  - techdocs-core <i class="conum" data-value="1"></i><b>(1)</b>

nav: <i class="conum" data-value="2"></i><b>(2)</b>
  - Home: index.md
  - Section 1:
      - Sub Section 1.1: section1/ss11.md
      - Sub Section 1.2: section1/ss12.md
      - Sub Section 1.3: section1/ss13.md</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable the <code>techdocs-core</code> plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Navigation structure of the documentation tree. The text before the ":" indicates the title of the navigation node and the text after it indicates the path to the file for a section. You can nest the section into sub-sections based on your layout needs</td>
</tr>
</table>
</div>
</li>
<li>
<p>The corresponding directory layout of the markdown source looks like the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">repo_root/
  docs/
    section1/
      ss11.md
      ss12.md
      ss13.md
    index.md
  catalog-info.yaml
  mkdocs.yml</code></pre>
</div>
</div>
</li>
<li>
<p>RHDH has already enabled the <strong>techdocs</strong> plugin by default for an "all local" configuration. The default plugin YAML file inside the container has the following configured:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
techdocs: <i class="conum" data-value="1"></i><b>(1)</b>
  generator:
    runIn: local
  builder: local
  publisher:
    type: local</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure TechDocs for "all local" mode</td>
</tr>
</table>
</div>
</li>
<li>
<p>The TechDocs dynamic plugin is enabled by default. In case it is not enabled, ensure the following entries are added to the <code>dynamic-plugins-rhdh-local</code> ConfigMap:</p>
<div class="literalblock">
<div class="content">
<pre>./dynamic-plugins/dist/backstage-plugin-techdocs
./dynamic-plugins/dist/backstage-plugin-techdocs-backend-dynamic</pre>
</div>
</div>
</li>
<li>
<p>If you made any changes to the RHDH YAML configuration files, restart the RHDH pod from the <code>Topology</code> view.</p>
</li>
<li>
<p>If you have not already done so, import the template file at <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/templates/react-ssr/template.yaml" class="bare">https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/templates/react-ssr/template.yaml</a> which contains the TechDocs skeleton code for a simple React front end application.</p>
</li>
<li>
<p>Create a new application from the template and navigate to the component details page. The <code>View Techdocs</code> tab should now be enabled and opening it renders the documentation for this component based on your <code>mkdocs.yaml</code> configuration.</p>
<div class="imageblock">
<div class="content">
<img src="_images/techdocs-render.png" alt="techdocs render">
</div>
<div class="title">Figure 3. Rendered Documentation</div>
</div>
</li>
<li>
<p>Click the <code>Search</code> button in the top left corner of the RHDH sidebar (in the RHDH home page). Enter <code>lorem</code> in the <code>Search field</code>, and observe that RHDH quickly presents you with a list of results where it found the term.</p>
<div class="imageblock">
<div class="content">
<img src="_images/search-results.png" alt="search results">
</div>
<div class="title">Figure 4. Search Results</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optional_challenge_lab_advanced_techdocs_using_external_generators_and_publishers"><a class="anchor" href="#_optional_challenge_lab_advanced_techdocs_using_external_generators_and_publishers"></a>Optional Challenge Lab: Advanced TechDocs using External Generators and Publishers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The blog post at <a href="https://janus-idp.io/blog/2023/06/03/production-ready-techdocs" class="bare">https://janus-idp.io/blog/2023/06/03/production-ready-techdocs</a> provides detailed instructions on how to configure TechDocs to use an external builder and publisher, along with CI/CD workflow automation to rebuild the markdown source based on Git webhook triggers. Make changes to your configuration to get the TechDocs plugin working with this set up.</p>
</div>
<div class="paragraph">
<p>Credits for Lab: Jason Froehlich (<a href="https://github.com/jayfray12" class="bare">https://github.com/jayfray12</a>)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://backstage.io/docs/features/techdocs/getting-started" target="_blank" rel="noopener">Getting Started with TechDocs in Backstage</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/features/techdocs/concepts" target="_blank" rel="noopener">TechDocs Concepts</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/features/techdocs/architecture" target="_blank" rel="noopener">TechDocs Architecture</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/features/techdocs/creating-and-publishing" target="_blank" rel="noopener">Writing TechDocs</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/features/techdocs/configuration" target="_blank" rel="noopener">TechDocs Configuration</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/features/techdocs/using-cloud-storage" target="_blank" rel="noopener">Using Cloud Storage for TechDocs</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/features/techdocs/configuring-ci-cd" target="_blank" rel="noopener">Using CI/CD to g=Generate TechDocs</a></p>
</li>
<li>
<p><a href="https://www.mkdocs.org/" target="_blank" rel="noopener">MkDocs Project Documentation Generator</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="templates.html">Software Templates</a></span>
  <span class="next"><a href="../chapter2/index.html">RHDH Plugins</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
