<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes and Topology Plugin :: Building Developer Portals with Red Hat Developer Hub</title>
    <link rel="prev" href="dynamic.html">
    <link rel="next" href="quay.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building Developer Portals with Red Hat Developer Hub</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/devhub-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="devhub-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building Developer Portals with Red Hat Developer Hub</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Software Templates</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/catalog.html">Software Catalog Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/templates.html">Software Templates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/techdocs.html">TechDocs and Search</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">RHDH Plugins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="dynamic.html">Dynamic Plugins</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="topology.html">Kubernetes and Topology Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quay.html">Quay Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pipelines.html">Tekton Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="gitops.html">ArgoCD Plugin</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building Developer Portals with Red Hat Developer Hub</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building Developer Portals with Red Hat Developer Hub</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building Developer Portals with Red Hat Developer Hub</a></li>
    <li><a href="index.html">RHDH Plugins</a></li>
    <li><a href="topology.html">Kubernetes and Topology Plugin</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Kubernetes and Topology Plugin</h1>
<div class="sect1">
<h2 id="_kubernetes_plugin"><a class="anchor" href="#_kubernetes_plugin"></a>Kubernetes Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Kubernetes plugin provides a <strong>read-only</strong> high-level overview of your applications and services deployed on Kubernetes, or the OpenShift Container Platform. Developers can easily check the status of their workloads across many different clusters (that is, a cluster where RHDH is deployed, or one or more external clusters hosting your applications and services).</p>
</div>
<div class="paragraph">
<p>It will display errors, if any, and provide a high-level glance at the deployments, pods, and other Kubernetes resources for a catalog item.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kube-plugin.png" alt="Kubernetes Plugin View">
</div>
</div>
<div class="paragraph">
<p>The Kubernetes plugin is made up of two separate smaller plugins, one back-end plugin that communicates with Kubernetes clusters, and a front-end plugin that visualizes the data in the RHDH component details page. To configure the Kubernetes plugin, you need to enable these two plugins in your dynamic plugin YAML configuration:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./dynamic-plugins/dist/backstage-plugin-kubernetes
./dynamic-plugins/dist/backstage-plugin-kubernetes-backend-dynamic</pre>
</div>
</div>
<div class="paragraph">
<p>Apart from enabling the plugins, you need to configure the backend plugin to access the Kubernetes clusters. You do this by creating a new Kubernetes <code>ClusterRole</code> with cluster-wide read-only permissions and then assigning this role to a service account for the plugin.</p>
</div>
<div class="paragraph">
<p>As a final step, you need to configure the plugin parameters (Kubernetes API Server URL, credentials, service accounts and a list of custom resources that need to be fetched from the cluster) in the <strong>kubernetes:</strong> section of your <strong>app-config.yaml</strong> files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_topology_plugin"><a class="anchor" href="#_topology_plugin"></a>Topology Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Topology plugin enables you to visualize Kubernetes resources such as <code>Deployment</code>, <code>Job</code>, <code>Daemonset</code>, <code>Statefulset</code>, <code>CronJob</code>, and <code>Pods</code> for any service deployed on the Kubernetes cluster. It requires the Kubernetes plugin to be enabled and configured for it to fetch data from clusters.</p>
</div>
<div class="paragraph">
<p>To configure the Topology plugin, you need to enable the plugin in your dynamic plugin YAML configuration:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./dynamic-plugins/dist/janus-idp-backstage-plugin-topology</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes_resource_labels_and_catalog_yaml_annotations"><a class="anchor" href="#_kubernetes_resource_labels_and_catalog_yaml_annotations"></a>Kubernetes Resource Labels and Catalog YAML Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may not want to visualize all workloads and resources in your Kubernetes cluster in RHDH. RHDH provides a flexible label and annotation mechanism to filter and identify resources that need to be visualized.</p>
</div>
<div class="paragraph">
<p>In your <strong>catalog-info.yaml</strong> files, you need to add <code>backstage.io/kubernetes-id</code> annotation under your components <code>metadata</code> field:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: hello
  title: Hello service
  ...
  annotations:
    backstage.io/kubernetes-id: 'hello'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Correspondingly on the Kubernetes resource side, you need to add a <code>backstage.io/kubernetes-id</code> label to the resources you want to track in RHDH:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">apiVersion: apps/v1
kind: Deployment
metadata:
  name: hello
  labels:
    app: hello
    backstage.io/kubernetes-id: 'hello'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Adding this label to every resource on the Kubernetes side quickly becomes repetitive and difficult to manage, especially when you have a large number of workloads deployed, and each workload has numerous resources deployed in the cluster.</p>
</div>
<div class="paragraph">
<p>To simplify resource discovery, you can use label selectors to query the Kubernetes API server and return a list of resources matching your label. For example, to fetch all resources matching the label <code>app=hello</code>, add a <code>backstage.io/kubernetes-label-selector</code> annotation to your component catalog descriptor:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: hello
  title: Hello service
  ...
  annotations:
    backstage.io/kubernetes-label-selector: 'app=hello'</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The label selector annotation makes use of the fact that adding labels to resources like <code>Deployment</code> types, applies the labels to all resources (Pods, Services, Routes etc.) that are a result of a successful deployment. This annotation and label selector mechanism also works for custom resources like Tekton&#8217;s <code>Pipeline</code> resource, where labels applied to the parent Pipeline resource are inherited by resources generated from a pipeline run, such as Pipelinerun and Taskrun resources.</p>
</div>
<div class="paragraph">
<p>The following hands-on labs describe the detailed steps to enable and configure the Kubernetes and Topology plugins for a simple nginx web application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_1_enabling_the_kubernetes_plugin"><a class="anchor" href="#_lab_1_enabling_the_kubernetes_plugin"></a>Lab 1: Enabling the Kubernetes Plugin</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the OpenShift cluster using the <code>oc</code> CLI tool as a cluster administrator (for RHDP based classrooms, usually <code>admin</code>. Consult the RHDP Service details page for log in details).</p>
</li>
<li>
<p>Download and inspect the YAML file at <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/1-cr.yaml" class="bare">https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/1-cr.yaml</a>. This file creates a <code>ClusterRole</code> that provides cluster-wide  <strong>read-only</strong> access to a service account. Adjust the values as per your environment.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: rhdh-topology-plugin
rules:
  # Base for Kubernetes plugin
  - apiGroups:
      - ''
    resources: <i class="conum" data-value="1"></i><b>(1)</b>
      - pods/log
      - pods
      - services
      - configmaps
      - resourcequotas
      - limitranges
    verbs: <i class="conum" data-value="2"></i><b>(2)</b>
      - get
      - watch
      - list
  - apiGroups:
...</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Lists of Kubernetes resources for which you want the plugin to fetch data from the Kubernetes API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Permissions allowed for this role. In this case, read-only permissions to list, get and watch these resources</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This file lists a number of custom resources that the plugin uses to fetch data. Add other resources to this YAML based on your workload.</p>
</div>
</li>
<li>
<p>Create the cluster role:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc apply -f 1-cr.yaml</strong></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Download and inspect the <code>ClusterRoleBinding</code> resource YAML file at <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/2-crb.yaml" class="bare">https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/2-crb.yaml</a>. This file binds the previously created <code>ClusterRole</code> with the <code>default</code> service account in the <code>devhub</code> namespace. Adjust the values for your environment, and run it using the <code>oc</code> CLI:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc apply -f 2-crb.yaml</strong></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>You need a service account token for the <code>default</code> service account to authenticate against the Kubernetes API server. Download and inspect the YAML file at <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/3-sa-token.yaml" class="bare">https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/3-sa-token.yaml</a>. Change it for your environment and apply it:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc apply -f 3-sa-token.yaml</strong>
secret/rhdh-sa-token created</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>You may have to wait for a minute while a secret token is generated. To get the token value, run:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><strong>oc -n devhub \
    get secret rhdh-sa-token \
    -o go-template='{{.data.token | base64decode}}'</strong>
eyJhbGciOiJSUzI1NiIsImtpXXXXXXXXXXXXXX</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Copy the generated token to the clipboard for use in the next steps.</p>
</div>
</li>
<li>
<p>Edit the <code>rhdh-secrets</code> Secret resource in the <code>devhub</code> namespace (You should have created this secret in previous labs)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select "Secret" in Red Hat OpenShift Console:</p>
<div class="imageblock">
<div class="content">
<img src="_images/secret.png" alt="secret">
</div>
<div class="title">Figure 1. Select Secret</div>
</div>
</li>
<li>
<p>Select <strong>rhdh-secrets</strong>, select <strong>YAML</strong> tab and add a new key named <code>K8S_SA_TOKEN</code> and set it&#8217;s value to the token you generated in the previous step.</p>
<div class="imageblock">
<div class="content">
<img src="_images/yaml_secret.png" alt="yaml secret">
</div>
<div class="title">Figure 2. Set K8S_SA_TOKEN secret</div>
</div>
<div class="paragraph">
<p>You will refer to this secret as an environment variable in the <code>app-config.yaml</code> file.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>You also need to add one more environment variable to the <code>rhdh-secrets</code> to prevent errors related to self-signed TLS certificates. Add this variable if and only if your cluster uses self-signed certificates. Add a new key called <strong>NODE_TLS_REJECT_UNAUTHORIZED</strong> and set its value to <strong>0</strong>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you fail to set this variable when using self-signed TLS certificates, you will get an error:
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Error communicating with Kubernetes: FETCH_ERROR, message: request to https://api.cluster.... failed, reason: self-signed certificate in certificate chain</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Edit the <code>app-config-rhdh</code> ConfigMap in the <code>devhub</code> namespace. Add the following section to configure the Kubernetes plugin (Add the <code>kubernetes:</code> key at the same level as the <code>app:</code> key):</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">    app:
...
    kubernetes:
      serviceLocatorMethod:
        type: 'multiTenant'
      clusterLocatorMethods:
        - type: 'config'
          clusters:
            - url: https://api.cluster-&lt;guid&gt;.dynamic.redhatworkshops.io:6443 <i class="conum" data-value="1"></i><b>(1)</b>
              name: ocp-cluster-&lt;guid&gt; <i class="conum" data-value="2"></i><b>(2)</b>
              authProvider: 'serviceAccount' <i class="conum" data-value="3"></i><b>(3)</b>
              skipTLSVerify: true <i class="conum" data-value="6"></i><b>(6)</b>
              serviceAccountToken: ${K8S_SA_TOKEN} <i class="conum" data-value="4"></i><b>(4)</b>
              customResources: <i class="conum" data-value="5"></i><b>(5)</b>
                - group: 'route.openshift.io'
                  apiVersion: 'v1'
                  plural: 'routes'
                - group: 'tekton.dev'
                  apiVersion: 'v1'
                  plural: 'pipelineruns'
                - group: 'tekton.dev'
                  apiVersion: 'v1'
                  plural: 'taskruns'</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Kubernetes Cluster API Server endpoint (Get this from your RHDP Service Details page). Replace <code>guid</code> with your unique GUID</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A unique name for this Kubernetes cluster. You can add multiple Kubernetes clusters under the <code>clusters:</code> key, each with its own unique name and configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use service accounts for authentication</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Token for the service account that connects to the Kubernetes API server</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Kubernetes custom resources that should be visible in RHDH. The base Kubernetes plugin only understands the vanilla Kubernetes API resources. Routes, pipelines and tasks are additions on top of the base Kubernetes API added by layered products like OpenShift Pipelines and the OpenShift platform router</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>For self-signed certificates, set this flag to <code>true</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kuber.png" alt="kuber">
</div>
<div class="title">Figure 3. Kubernetes Settings</div>
</div>
</li>
<li>
<p>Edit the <code>dynamic-plugins-rhdh-local</code> ConfigMap and enable the Kubernetes backend and frontend plugins:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  - package: './dynamic-plugins/dist/backstage-plugin-kubernetes'
    disabled: false
  - package: './dynamic-plugins/dist/backstage-plugin-kubernetes-backend-dynamic'
    disabled: false</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/plugin_kuber.png" alt="plugin kuber">
</div>
<div class="title">Figure 4. Enable Kubernetes Plugin</div>
</div>
</li>
<li>
<p>Restart the RHDH pod for the new configuration to take effect. Wait until the RHDH container is fully up and running.</p>
</li>
<li>
<p>You are now ready to deploy a simple nginx based web application. Inspect the deployment YAML resource at <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/5-nginx-deploy.yml" class="bare">https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/5-nginx-deploy.yml</a>. Adjust the values for your environment.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-ex
  labels: <i class="conum" data-value="1"></i><b>(1)</b>
    app: nginx
    app.openshift.io/runtime: nginx
    backstage.io/kubernetes-id: nginx-ex <i class="conum" data-value="2"></i><b>(2)</b>
...
---
apiVersion: v1
kind: Service
...
---
apiVersion: route.openshift.io/v1
kind: Route
...</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Labels to be applied on this Deployment resource</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Label that identifies this component uniquely for the RHDH catalog</td>
</tr>
</table>
</div>
</li>
<li>
<p>Deploy the application in the <code>myapps</code> namespace (Create this namespace/project if it does not exist)</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">oc create namespace myapps
oc apply -f 5-nginx-deploy.yml -n myapps</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Finally, inspect the catalog YAML descriptor file for this component at <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/6-catalog-info.yml" class="bare">https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/6-catalog-info.yml</a>. Adjust the values for your environment.</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: nginx-ex
  title: Nginx example service
...
  annotations: <i class="conum" data-value="1"></i><b>(1)</b>
    backstage.io/kubernetes-id: 'nginx-ex'
    backstage.io/kubernetes-namespace: myapps
    backstage.io/kubernetes-label-selector: 'app=nginx' <i class="conum" data-value="2"></i><b>(2)</b>
spec:
...</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotation for this component</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Label selector for this component using Kubernetes labels. The corresponding labels must exist on the Kubernetes resources.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Import the component into the RHDH catalog.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the <code>Create &gt; Register Existing Component</code> page from Red Hat Developer Hub.</p>
<div class="imageblock">
<div class="content">
<img src="_images/template.png" alt="template">
</div>
<div class="title">Figure 5. Import Component</div>
</div>
</li>
<li>
<p>Provide the full path to the <a href="https://github.com/RedHatQuickCourses/devhub-qc-apps/blob/main/kube/6-catalog-info.yml">6-catalog-info.yml</a> file from the previous step and click <strong>Analyse</strong>:</p>
<div class="imageblock">
<div class="content">
<img src="_images/analyse.png" alt="analyse">
</div>
<div class="title">Figure 6. Analyse URL</div>
</div>
</li>
<li>
<p>Click <strong>Import</strong>:</p>
<div class="imageblock">
<div class="content">
<img src="_images/import.png" alt="import">
</div>
<div class="title">Figure 7. Import Component</div>
</div>
</li>
<li>
<p>After the component is imported, verify that the component is listed in the <code>Catalog</code> page and click on <code>Nginx example service</code> to view the component details. You can safely ignore any warning messages about relations to other entities.</p>
<div class="imageblock">
<div class="content">
<img src="_images/view.png" alt="view">
</div>
<div class="title">Figure 8. View Component</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Verify that a new <code>Kubernetes</code> tab is seen. Click on the <code>Kubernetes</code> tab to view the details provided by the Kubernetes plugin. You can ignore the warning messages about fetching kubernetes resources (This application does not have any tekton pipelines or tasks. You will create pipeline and task resources in subsequent labs for the RHDH Tekton plugin).</p>
<div class="imageblock">
<div class="content">
<img src="_images/kube-plugin-view.png" alt="kube plugin view">
</div>
<div class="title">Figure 9. Kubernetes Plugin View</div>
</div>
<div class="paragraph">
<p>Verify that Kubernetes resources tagged with the labels that match your catalog YAML annotations are seen in this view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kube-plugin-resources.png" alt="kube plugin resources">
</div>
<div class="title">Figure 10. Kubernetes Resources for Component</div>
</div>
</li>
<li>
<p>Expand the <code>Deployment</code> card for <code>nginx-ex</code> to see the pod status for this application.</p>
<div class="imageblock">
<div class="content">
<img src="_images/kubernetes-resources-view.png" alt="kubernetes resources view">
</div>
<div class="title">Figure 11. Kubernetes Pod View</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_2_enabling_the_topology_plugin"><a class="anchor" href="#_lab_2_enabling_the_topology_plugin"></a>Lab 2: Enabling the Topology Plugin</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h3>
<div class="ulist">
<ul>
<li>
<p>You need to ensure that the Kubernetes plugin is configured and enabled as outlined in the previous lab. Specifically, the <code>ClusterRole</code>, <code>ClusterRoleBinding</code>, the service account and token generation steps should be completed before enabling and configuring the Topology plugin. You must also ensure that the <code>app-config.yaml</code> contains a valid <code>kubernetes:</code> section with the details and authentication token for the cluster.</p>
</li>
<li>
<p>You should have deployed the <code>nginx-ex</code> example web application outlined in the previous lab to test the Kubernetes plugin. You will use the same component to test the Topology plugin.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_steps_2"><a class="anchor" href="#_steps_2"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the Topology plugin in the <code>dynamic-plugins-rhdh-local</code> ConfigMap:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  - package: './dynamic-plugins/dist/backstage-community-plugin-topology'
    disabled: false</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Switch to the <code>Topology</code> view and restart the RHDH pod. Wait until the RHDH container is redeployed with the new configuration.</p>
</li>
<li>
<p>Open the component details page for the <code>Nginx example service</code> component and observe that a new <code>Topology</code> tab has been enabled for this component. Click <code>Topology</code> to view the details.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Due to the browser caching static assets like HTML and Javascript files, you may have to refresh the page, or open the component details page in the browser incognito/private mode for the <code>Topology</code> tab to be seen.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You should see the Topology plugin displaying the details of the nginx application similar to how it is displayed in the OpenShift web console:</p>
<div class="paragraph">
<p><span class="image"><img src="_images/topology-plugin-view.png" alt="topology plugin view" title="Topology Plugin Overview"></span></p>
</div>
</li>
<li>
<p>Click on the <code>NGINX</code> icon in the view to see more detailed information about your deployment.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/topology-details.png" alt="topology details" title="Topology Plugin Details"></span></p>
</div>
</li>
<li>
<p>Click on the <code>Resources</code> tab in the right-side panel to view the details of the pods. You should see two pods as per the Deployment definition for the nginx application. You should also see the service and route definition.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/topology-pods.png" alt="topology pods" title="Topology Pod Details"></span></p>
</div>
</li>
<li>
<p>Click on <code>View Logs</code> for one of the pods to see the container logs. The Topology plugin provides useful information for a developer to identify any issues with his application deployments.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/pod-logs.png" alt="pod logs" title="Container Logs"></span></p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://backstage.io/docs/features/kubernetes/configuration">Backstage Kubernetes Plugin Configuration</a></p>
</li>
<li>
<p><a href="https://developers.redhat.com/rhdh/plugins#redhatnotpreinstalled" target="_blank" rel="noopener">Plugins available in RHDH 1.4</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="dynamic.html">Dynamic Plugins</a></span>
  <span class="next"><a href="quay.html">Quay Plugin</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
